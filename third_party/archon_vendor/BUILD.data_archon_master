package(default_visibility = ["//visibility:public"])
cc_library(
    name = "archon",
    srcs = glob([
        "src/archon/utils/*.cpp",
        "src/archon/async/*.cpp",
        "src/archon/client/*.cpp",
        "src/archon/codec/*.cpp",
        "src/archon/common/*.cpp",
        "src/archon/concurrent/*.cpp",
        "src/archon/config/*.cpp",
        "src/archon/dts/*.cpp",
        "src/archon/fbthrift/*/*.cpp",
        "src/archon/govern/*.cpp",
        "src/archon/lb/*.cpp",
        "src/archon/log/*.cpp",
        "src/archon/mesh/**/*.cpp",
        "src/archon/metrics/*.cpp",
        "src/archon/protobuf/*.cpp",
        "src/archon/protobuf/*/*.cpp",
        "src/archon/raw/*.cpp",
        "src/archon/rdma/*.cpp",
        "src/archon/rdma/thrift/*.cpp",
        "src/archon/server/*.cpp",
        "src/archon/server/optimize/*.cpp",
        "src/archon/state/*.cpp",
        "src/archon/stats/*.cpp",
        "src/archon/stats/mixer/*.cpp",
        "src/archon/trace/*.cpp",
        "src/archon/transport/*.cpp",
        "src/archon/http/*.cpp",
        "src/archon/monitor/*.cpp",
    ]),
    hdrs = glob([
        "src/**/*",
        "**/*.h",
        "**/*.hpp",
    ]),
    copts = [
        "-std=c++14",
        "-DGLOG_NO_ABBREVIATED_SEVERITIES",
        "-I.",
        "-g",
        "-O3",
        "-Wall",
        "-Werror",
        "-Wextra",
        "-Wno-error=unused-but-set-variable",
        "-Wno-error=unused-parameter",
        "-Wno-error=unused-variable",
        "-Wno-missing-field-initializers",
        "-Wno-sign-compare",
        "-Wno-error=deprecated-declarations",
    ],
    includes = [
        "src",
    ],
    deps = [
        ":error_pb",
        ":mixer_pb",
        "@cpp3rdlib_boost_1.72.0-gcc8//:boost",
        "@cpp3rdlib_boost_1.72.0-gcc8//:boost_thread",
        "@cpp3rdlib_bzip2_1.0.6-gcc8//:bz2",
        "@curl//:curl",
        "@cpp3rdlib_double-conversion_3.1.5-gcc8//:double-conversion",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:security",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:thrift",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:thriftcpp2",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:thriftfrozen2",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:thriftprotocol",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:transport",
        "@com_github_gflags_gflags//:gflags",
        "@com_google_glog//:glog",
        "@cpp3rdlib_murmurhash3_master-gcc8//:murmurhash3",
        "@cpp3rdlib_openssl_1.0.2-gcc8//:crypto",
        "@cpp3rdlib_openssl_1.0.2-gcc8//:ssl",
        "@cpp3rdlib_jemalloc_5.2.1-gcc8//:jemalloc",
        "@cpputil_bytedtrace_1.0.0//:bytedtrace",
        "@cpputil_common_1.0.0//:common_utils",
        "@cpputil_hdr_histogram_master//:HdrHistogram",
        "@cpputil_infsec_master-gcc8//:infsec",
        "@cpputil_json_1.0.0//:json",
        "@cpputil_log_1.0.0//:log",
        "@cpputil_metrics2_1.0.0//:metrics2",
        "@cpputil_program_1.0.0//:conf",
        "@cpputil_psutil_master//:psutil",
        "@cpputil_tcc_1.0.0//:tcc",
        "@data-arch_data_trace_service_master//:dts_collector",
        "@data_byte_express_1.0.6//:ByteExpress",
        "@data_ciao_0.0.5//:ciao",
        "@data_circuitbreaker_master//:circuitbreaker",
        "@log_market_CppLogSDK_master//:logcxxsdk",
        "@opentracing//:opentracing-cpp",
        "@trace_trace-client-cpp_archon//:trace-client-cpp_fbthrift",
        "@data-arch_beacon_master//:beacon",
        "@service_mesh_shmipc_cpp_master//:shmipc",
    ],
)

filegroup(
    name = "archon_lib",
    srcs = [
        "lib",
        "@cpp3rdlib_boost_1.72.0-gcc8//:boost_lib",
        "@cpp3rdlib_bzip2_1.0.6-gcc8//:bz2_lib",
        "@curl//:curl_lib",
        "@cpp3rdlib_double-conversion_3.1.5-gcc8//:double-conversion_lib",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:security_lib",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:thrift_lib",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:thriftcpp2_lib",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:thriftfrozen2_lib",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:thriftprotocol_lib",
        "@cpp3rdlib_fbthrift_v2018.08.20.00-gcc8//:transport_lib",
        "@com_github_gflags_gflags//:gflags_lib",
        
        "@cpp3rdlib_murmurhash3_master-gcc8//:murmurhash3_lib",
        "@cpp3rdlib_openssl_1.0.2-gcc8//:crypto_lib",
        "@cpp3rdlib_openssl_1.0.2-gcc8//:ssl_lib",
        "@cpp3rdlib_jemalloc_5.2.1-gcc8//:jemalloc_lib",
        "@cpputil_bytedtrace_1.0.0//:bytedtrace_lib",
        "@cpputil_common_1.0.0//:common_utils_lib",
        "@cpputil_hdr_histogram_master//:HdrHistogram_lib",
        "@cpputil_infsec_master-gcc8//:infsec_lib",
        "@cpputil_json_1.0.0//:json_lib",
        "@cpputil_log_1.0.0//:log_lib",
        "@cpputil_metrics2_1.0.0//:metrics2_lib",
        "@cpputil_program_1.0.0//:conf_lib",
        "@cpputil_psutil_master//:psutil_lib",
        "@cpputil_tcc_1.0.0//:tcc_lib",
        "@data-arch_data_trace_service_master//:dts_collector_lib",
        "@data_byte_express_1.0.6//:ByteExpress_lib",
        "@data_ciao_0.0.5//:ciao_lib",
        "@data_circuitbreaker_master//:circuitbreaker_lib",
        "@log_market_CppLogSDK_master//:logcxxsdk_lib",
        "@trace_trace-client-cpp_archon//:trace-client-cpp_fbthrift_lib",
    ],
)

proto_library(
    name = "cc_error_pb",
    srcs = ["src/archon/protobuf/error/error.proto"],
    strip_import_prefix = "src",
)

proto_library(
    name = "cc_mixer_pb",
    srcs = ["src/archon/stats/mixer/mixer.proto"],
    strip_import_prefix = "src",
)

cc_proto_library(
    name = "error_pb",
    deps = [
        ":cc_error_pb",
    ],
)

cc_proto_library(
    name = "mixer_pb",
    deps = [
        ":cc_mixer_pb",
    ],
)

